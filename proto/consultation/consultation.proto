syntax = "proto3";

package consultation;

option go_package = "consultation-service/internal/consultation/delivery/grpc/pb;pb";

import "google/protobuf/timestamp.proto";

import "google/protobuf/wrappers.proto";

// Base Structure
// {
//   "_id": "consul_12345",
//   "patient_id": "cust_001",
//   "patient_name": "John Doe",
//   "doctor_id": "doc_456",
//   "doctor_name": "dr. Rahmat",
//   "room_id": "room_78",
//   "room_name": "Ruang Konsul 1",
//   "created_by": "user_999",
//   "symptoms": "Demam dan batuk",
//   "diagnosis": "Infeksi saluran pernapasan",
//   "prescription": [
//     { "name": "Paracetamol", "dose": "3x sehari" },
//     { "name": "OBH", "dose": "2x sehari" }
//   ],
//   "created_at": "2025-07-21T14:00:00Z"
// }

message UserSnapshot {
  string id = 1; // unique identifier for the user
  string name = 2; // name of the user
  string email = 3; // email of the user
  string role = 4; // role of the user
}

message DoctorSnapshot {
  string id = 1; // unique identifier for the doctor
  string name = 2; // name of the doctor
  string specialization = 3; // specialization of the doctor
}

message PatientSnapshot {
  string id = 1; // unique identifier for the patient
  string name = 2; // name of the patient
  string age = 3; // age of the patient
}

message RoomSnapshot {
  string id = 1; // unique identifier for the room
  string name = 2; // name of the room
}

// ConsultationRequest represents a request for a consultation
message Prescription {
  string name = 1; // name of the medicine
  string dose = 2; // dosage instructions
}

message ConsultationRequest {
  string id = 1;
  string queue_id = 2;
  string appointment_id = 3;
  PatientSnapshot patient = 4; // from master-service
  DoctorSnapshot doctor = 5; // from master-service
  RoomSnapshot room = 6; // from master-service
  string symptoms = 7;
  repeated Prescription prescription = 8; // list of prescriptions
  string diagnosis = 9;
  string date = 10; // date of the consultation
}

message ConsultationResponse {
    string id = 1; // unique identifier for the consultation
    google.protobuf.StringValue queue_id = 2;
    google.protobuf.StringValue appointment_id = 3;
    UserSnapshot user = 4; // user who created the consultation
    PatientSnapshot patient = 5; // from master-service
    DoctorSnapshot doctor = 6; // from master-service
    RoomSnapshot room = 7; // from master-service
    string symptoms = 8;
    repeated Prescription prescription = 9; // list of prescriptions
    string diagnosis = 10;
    string date = 11;
    string status = 12;
    
    google.protobuf.Timestamp created_at = 13;
    google.protobuf.Timestamp updated_at = 14;
}

message ConsultationIDRequest {
  string id = 1; // unique identifier for the consultation
}

service ConsultationService {
  // Create a new consultation
  rpc CreateConsultation(ConsultationRequest) returns (ConsultationResponse);
  // Get a consultation by ID
  rpc FindByIDConsultation(ConsultationIDRequest) returns (ConsultationResponse);
  // Update an existing consultation
  rpc UpdateConsultation(ConsultationRequest) returns (ConsultationResponse);
}